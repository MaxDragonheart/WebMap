<div class="map-wrapper">
  <div id="map" class="map"></div>

  {{ if .Config.controls.slider }}
  <div class="map-slider">
    <label for="opacity">Opacità raster</label>
    <input id="opacity" type="range" min="0" max="1" step="0.05"
           value="{{ if .Config.raster.opacity }}{{ .Config.raster.opacity }}{{ else }}1{{ end }}">
  </div>
  {{ end }}

  {{ if .Config.popup.enabled }}
  <div id="popup" class="ol-popup">
    <a href="#" id="popup-closer" class="ol-popup-closer"></a>
    <div id="popup-content"></div>
  </div>
  {{ end }}

  <!-- BOX COORDINATE: ALTO CENTRO -->
  <div class="map-top-center" id="map-coords">
    <span class="coord-label">Lon:</span>
    <span id="lon-value" class="coord-value">—</span>
    <span class="sep">|</span>
    <span class="coord-label">Lat:</span>
    <span id="lat-value" class="coord-value">—</span>
  </div>

  <!-- SWITCHER BASEMAP: RADIO BUTTON (alto destra) -->
  <div class="map-basemap-radios" id="basemap-radios" hidden>
    <!-- popolato via JS -->
  </div>
</div>

<script>
  window.__MAP_CONFIG__ = {{ .Config | jsonify }};
  document.addEventListener("DOMContentLoaded", function(){
    const map = window.createMap(window.__MAP_CONFIG__, "map", {
      popupContainerId: "popup",
      popupCloserId: "popup-closer",
      popupContentId: "popup-content",
      opacitySliderId: "opacity"
    });

    // Coordinate live
    if (map && window.getMouseCoordinates) {
      window.getMouseCoordinates(map, "lon-value", "lat-value");
    }

    // Inizializza gruppo radio per basemap (stile vecchia mappa)
    if (window.initBasemapRadios) {
      window.initBasemapRadios("basemap-radios", window.__MAP_CONFIG__);
    }
  });
</script>
