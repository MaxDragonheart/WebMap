{{ define "head_extra" }}
  {{ with .Resources.GetMatch "map*.css" }}
    <link rel="stylesheet" href="{{ .RelPermalink }}">
  {{ end }}
{{ end }}

{{ define "main" }}
<section id="map" class="map-container">

  <!-- UI -->
  <div class="reset-control"><button id="reset-view" title="Reset">⟲</button></div>
  <div class="basemap-select">
    <select id="basemap-select" aria-label="Scegli basemap"></select>
  </div>
  <div id="coords-container" class="coords-container">Lon: —  Lat: —</div>
  <div id="scale-container" class="scale-bar-container"></div>

  <!-- Iniezione config dal data/maps/<slug>.yaml -->
  <script>
    (function () {
      try {
        // Ricaviamo uno slug affidabile anche con page bundle
        var slug = {{ with .Params.slug }}{{ . | jsonify }}{{ else }}{{ .File.TranslationBaseName | jsonify }}{{ end }};
        // Tenta: data/maps/<slug>.yaml
        var cfg = {{ with index site.Data.maps (.Params.slug) }}{{ . | jsonify }}{{ else }}{}{{ end }};

        if (!cfg || (typeof cfg === "object" && Object.keys(cfg).length === 0)) {
          console.warn("[single] Config YAML non trovata per slug:", slug,
                       " — verifica che il file esista in data/maps/"+slug+".yaml");
        } else {
          console.log("[single] YAML trovato per slug:", slug, cfg);
        }

        window.__MAP_CONFIG__ = cfg || {};
        window.__MAP_TITLE__  = {{ .Title | jsonify }};
      } catch (e) {
        console.error("[single] Errore preparando __MAP_CONFIG__:", e);
        window.__MAP_CONFIG__ = {};
      }
    })();
  </script>

  {{ with .Resources.GetMatch "map*.js" }}
    <script src="{{ .RelPermalink }}"></script>
  {{ end }}

</section>
{{ end }}
