{{/* PARTIAL CHE CARICA STILI/JS E INIZIALIZZA LA MAPPA */}}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css">
<link rel="stylesheet" href="{{ "css/site.css" | relURL }}">
<link rel="stylesheet" href="{{ "css/map.css"  | relURL }}">

<script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>

<!-- Core JS UMD (nessun import/export) -->
<script src="{{ "js/map-core.js" | relURL }}"></script>

<!-- Config per-mappa dal Page Bundle -->
{{ $cfgName := default "map-config.js" .Page.Params.map_config }}
{{ $cfg := .Page.Resources.GetMatch $cfgName }}
{{ if $cfg }}
  <script src="{{ $cfg.RelPermalink }}"></script>
{{ else }}
  <script>console.error('Map config non trovato: {{ $cfgName }}');</script>
{{ end }}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    if (!window.createMap) {
      console.error("createMap non Ã¨ definita: controlla js/map-core.js");
      return;
    }
    if (!document.getElementById("map")) {
      console.error("Elemento #map non trovato nel DOM");
      return;
    }
    if (!window.__MAP_CONFIG__) {
      console.error("window.__MAP_CONFIG__ non definito; verifica il file di config della mappa.");
      return;
    }

    window.createMap(window.__MAP_CONFIG__, "map", {
      popupContainerId: "popup",
      popupCloserId: "popup-closer",
      popupContentId: "popup-content",
      opacitySliderId: "opacity"
    });
  });
</script>
